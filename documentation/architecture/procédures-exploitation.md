
# Procédures d’exploitation

---
## Objectif

Cette documentation décrit en détail l'utilisation des services du CHU, leur mode opératoire, les vérifications à effectuer ainsi que les bonnes pratiques pour garantir la sécurité su SI.

---

## 1. Serveur LDAP (OpenLDAP)

### Procédure : Ajouter un utilisateur

- Préparer un fichier LDIF avec les informations utilisateur.  

`user.ldif` :
```makefile
dn: uid=Kkevin,ou=users,dc=chu,dc=ynov
objectClass: inetOrgPerson
cn: kevin kevin
sn: kevin
uid: Kkev
userPassword: *******
```

- Appliquer la modification :

```bash
dapadd -x -D "cn=admin,dc=chu,dc=ynov" -W -f user.ldif
```

- Vérifier l’ajout avec :

```bash
ldapsearch -x -b "dc=chu,dc=ynov" "uid=Kkev"
```

### Procédure : Modifier les rôles d’un utilisateur

- Préparer un fichier LDIF avec les modifications de rôle.
- Appliquer la modification :

```bash
ldapmodify -x -D "cn=admin,dc=chu,dc=ynov" -W -f user_update.ldif
```

### Procédure : Sauvegarder la base LDAP

```bash
slapcat -v -l /backup/ldap_backup.ldif
```

---

## 2. Serveur Web Apache

### Procédure : Déployer un nouveau site

- Créer le dossier du site dans `/var/www/`.
- Ajouter un fichier de configuration dans `/etc/apache2/sites-available/nom_site.conf`.

- Pour activer le site :

```bash
a2ensite nom_site
systemctl reload apache2
```

- Puis vérifier l’accès via navigateur.

### Procédure : Mettre en place HTTPS avec Let’s Encrypt

- Installer Certbot :

```bash
apt install certbot python3-certbot-apache
```

- Lancer la commande : 

```bash
certbot --apache -d chu.ynov
```

---

## 3. IDS/IPS Snort

### Procédure : Démarrer le service

- Lancer la commande : 

```bash
systemctl start snort
systemctl enable snort
```

### Procédure : Vérifier les logs

- Lancer la commande : 

```bash
tail -f /var/log/snort/alert
```

### Procédure : Mise à jour des règles de détection

- utiliser les règles à jour de la communauté. : 

```bash
cd /etc/snort/rules
wget https://www.snort.org/downloads/community/community-rules.tar.gz
tar -xvzf community-rules.tar.gz
```

- Redémarrer Snort :

```bash
systemctl restart snort
```

---

## 4. SIEM Wazuh

### Procédure : Consultation des alertes

- Se connecter à Kibana.
- Ouvrir le tableau de bord Wazuh.
- Appliquer les filtres pour afficher les alertes récentes.

---

## 5. Sauvegarde Bacula

### Procédure : Lancer un job de sauvegarde manuel

- Ouvrir la console Bacula :

```bash
bconsole
```

- Lancer le job :

```
run job=nom_job
```

### Procédure : Restaurer un fichier

- Ouvrir la console Bacula.
- Lancer la restauration :

```
restore
```

- Suivre les instructions pour sélectionner la sauvegarde et le fichier.

---

## 6. Pare-feu iptables

### Procédure : Afficher les règles actuelles

```bash
iptables -L -v
```
### Procédure : Ajouter une règle pour autoriser SSH depuis l’administration

```bash
iptables -A INPUT -p tcp --dport 22 -s 192.168.10.0/24 -j ACCEPT
iptables-save > /etc/iptables/rules.v4
```

---

## 7. Switchs couche 3

### Procédure : Ajouter un VLAN

  - Se connecter en CLI au switch.
  - Créer un VLAN :
```sql
vlan 50
name CANTINE
exit
```

- Puis assigner les ports au VLAN.

---

## 9. Journalisation et surveillance

### Procédure : Centraliser les logs avec rsyslog vers SIEM

- Configurer `/etc/rsyslog.conf` sur les clients :

```
*.* @192.168.30.3:514
```

- Puis redémarrer rsyslog :

```bash
systemctl restart rsyslog
```

---

## 10. Partage de fichiers

### Procédure : Création des dossiers partagés

- Lancer la commande : 

```bash
mkdir -p /srv/partage/medecins
chown -R root:medecins /srv/partage/medecins
chmod 770 /srv/partage/medecins
```

- Modification du fichier `/etc/samba/smb.conf` :

```ini
[global]
workgroup = CHU
security = user
passdb backend = tdbsam
log file = /var/log/samba/log.%m

[Medecins]
   path = /srv/partage/medecins
   valid users = @medecins
   read only = no
```

- Redémarrer le service : 
```bash
systemctl restart smbd
```